# ~/.sh_profile - Setup shell environment
# NOTE: This file is sourced always to have same environment on non-login and
# login shells.
# NOTE: Don't use export VAR=value as it is not supported in Bourne shell

# {{{ Functions
# Add existing $1 to $PATH once. Optionally after the last item if $2="after".
function pathmunge() {
	[ -d "$1" ] || return
	case ":${PATH}:" in
		*:"$1":*) ;;
		*) [ "$2" = "after" ] && PATH=$PATH:$1 || PATH=$1:$PATH
	esac
}
# }}}


# {{{ Umask
# Set umask for users beyond reserved uid/gids (on my uid >= 100000).
# NOTE: applies only on users in their own groups.
if [ $UID -gt 1000 ] && [ "$(id -gn)" = "$(id -un)" ]; then
	umask 002
else
	umask 022
fi
# }}}


# {{{ Environment defaults
EDITOR=vim
VISUAL=vim
PAGER=less

# E-mail check paths
# NOTE: find all Maildirs under ~/mail
# TODO

# Debian/Ubuntu developer environment
DEBFULLNAME="Ondrej Balaz"
DEBEMAIL="blami@blami.net"
# }}}


# {{{ Host
# Hostname if $HOST not set
if [ -z "$HOST" ]; then
	HOST=$(hostname)
fi

# OS and OS-ARCH
OS=$(echo "$(uname -s)" | tr '[:upper:]' '[:lower:]')
[ "${OS:0:6}" == "cygwin" ] && OS="cygwin" # use cygwin instead of cygwin-XX
OSARCH=$(echo "$OS-$(uname -m)" | tr '[:upper:]' '[:lower:]')
# }}}


# {{{ Path
pathmunge $HOME/bin/$HOST
pathmunge $HOME/bin/$OS
pathmunge $HOME/bin/$OSARCH
pathmunge $HOME/bin

export PATH
# }}}


# {{{ Profile in ~/profile.d
if [ -d $HOME/.profile.d ]; then
	for p in ~/.profile.d/*.sh ; do
		if [ -r "$p" ] && [ "${-#*p}" != "$-" ]; then
			source "$p"
		else
			source "$p" >/dev/null 2>&1
		fi
	done
	unset p
fi
# }}}


# {{{ Includes
# Local configuration
[ -r $HOME/.sh_profile_local ] && source $HOME/.sh_profile_local
[ -r $HOME/.sh_profile_$HOST ] && source $HOME/.sh_profile_$HOST

# Other files (interactive functions, aliases, etc.)
# NOTE Only bare files should be sourced, _local/_$HOST variant is sourced
# from them.
[ -r $HOME/.sh_funcs ] && source $HOME/.sh_funcs
[ -r $HOME/.sh_aliases ] && source $HOME/.sh_aliases

# Clear exit code (if any optional file doesn't exist)
builtin true
# }}}


unset -f pathmunge


# vim:set ft=sh:

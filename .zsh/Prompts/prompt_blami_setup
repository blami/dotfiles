# ~/.zsh/prompt_blami_setup: blami prompt theme

prompt_blami_setup () {
    emulate -L zsh
    setopt noxtrace transient_rprompt
    prompt_opts=(cr percent)

    # Prompt fields are stored in assoc. array ${prompt_blami} to avoid
    # unnecessary updates (e.g. username@host evaluation, etc.)
    typeset -gA prompt_blami

    prompt_blami[hostname]=$(prompt_blami_hostname)

    # {{{ Hooks
    # Pre-command hook
    precmd() {
        local exit_status=$?

        local PS1_info          # info widgets line
        local PS1_prompt        # prompt line

        PS1_info=""
        PS1_prompt="[%n@%m %2~]%(#.#.$)"

        # Set prompts
        PS1="${prompt_newline}${PS1_prompt} "
        [ ! -z $PS1_info ] && PS1="${prompt_newline}${PS1_info}${PS1}"
        PS2="%_> "
        PS3="#> "

        RPS1=
        [ $exit_status -ne 0 ] && RPS1="?${exit_status} "
    }

    # Pre-execution hook
    preexec() {

    }

    # Directory change hook
    chdir() {

    }
    # }}}


    # Add to given variable
    prompt_add () {

    }
}

# {{{ Helper functions
# Output hostname on remote connections
prompt_blami_hostname () {
    local hostname=
    # NOTE Don't use %m as we need to know $HOST for colors
    if [ ! -z ${SSH_CONNECTION} ]; then
        hostname=${HOST}
    fi

    [ ! -z $hostname ] && echo "@${hostname}"
}
# }}}


prompt_blami_setup "$@"

---
# Remove and disable Snap

- name: Removing Snap
  apt:
    pkg:
      - snapd
      - gnome-software-plugin-snap
    state: absent
    purge: true

- name: Disabling Snap auto-installation
  dpkg_selections:
    name: snapd
    selection: hold

# In upgraded installations of Ubuntu this file can be left over and cause APT
# to not operate properly.
- name: Removing /etc/apt/apt.conf.d/20snapd.conf
  file:
    path: /etc/apt/apt.conf.d/20snapd.conf
    state: absent
  when:
    - "\"packages\" in ansible_facts"
    - "\"snapd\" not in ansible_facts.packages"

- name: Removing Snap Directories
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /snap
    - /var/snap
    - /var/lib/snap
    - /var/cache/snapd

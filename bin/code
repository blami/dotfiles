#!/bin/sh
# code - Visual Studio Code wrapper
# NOTE: Depends on my ~/.zsh* for $OS, $WSL, etc.

VSCODE=
find_vscode() {
	for p in "$@"; do
		if [ -x "$p" ]; then
			VSCODE="$p"
			break
		fi
	done
}

case "$OS" in
	linux|bsd)
		if [ -z "$WSL" ]; then
			find_vscode \
				/usr/bin/code \
				/usr/local/bin/code \
				"$HOME"/.opt/vscode/bin/code
		else 
			find_vscode \
				"$WSL_MOUNT"/c/Program\ Files/Microsoft\ VS\ Code/bin/code \
				"$WSL_MOUNT"/c/Users/"$WSL_USER"/AppData/Local/Programs/Microsoft\ VS\ Code/bin/code
		fi
		;;
	macos)
		find_vscode \
			/usr/local/bin/code \
			/Applications/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code \
			/Applications/Developer/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code \
			/Users/"$USER"/Applications/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code \
			/Users/"$USER"/Applications/DeveloperVisual\ Studio\ Code.app/Contents/Resources/app/bin/code
		;;
	*)
		echo >&2 "code: unsupported OS=$OS"; aexit 1
		;;
esac

if [ -z "$VSCODE" ]; then
	echo >&2 "code: Microsoft VS Code not found" ; exit 1
fi
exec "$VSCODE" "$@"
